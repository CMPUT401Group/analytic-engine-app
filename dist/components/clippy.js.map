{"version":3,"sources":["../../src/components/clippy.js"],"names":["window","clippy","Agent","path","data","sounds","_queue","Queue","$","proxy","_onQueueEmpty","_el","hide","document","body","append","_animator","Animator","_balloon","Balloon","_setupEvents","prototype","gestureAt","x","y","d","_getDirection","gAnim","lookAnim","animation","hasAnimation","play","fast","callback","_hidden","el","stop","pause","_playInternal","moveTo","duration","dir","anim","undefined","_addToQueue","complete","css","top","left","reposition","animate","name","state","States","EXITED","WAITING","exitAnimation","_isIdleAnimation","_idleDfd","done","showAnimation","timeout","cb","completed","setTimeout","show","resume","width","height","scrollTop","speak","text","hold","closeBalloon","delay","time","stopCurrent","close","clear","animations","Math","floor","random","length","indexOf","offset","h","w","centerX","centerY","a","b","r","round","atan2","PI","idleAnim","_getIdleAnimation","Deferred","_onIdleComplete","resolve","c","currentAnimationName","i","push","idx","on","_onMouseDown","_onDoubleClick","is","o","bH","outerHeight","bW","outerWidth","wW","wH","sT","sL","scrollLeft","m","e","preventDefault","_startDrag","_offset","_calculateClickOffset","_moveHandle","_dragMove","_upHandle","_finishDrag","_dragUpdateLoop","_updateLocation","mouseX","pageX","mouseY","pageY","_targetY","_taregtX","clientX","clientY","clearTimeout","off","func","scope","queue","_data","_path","_currentFrameIndex","_currentFrame","_exiting","_currentAnimation","_endCallback","_started","_sounds","preloadSounds","_overlays","curr","_setupElement","overlayCount","inner","frameSize","framesize","n","snd","uri","Audio","animationName","stateChangeCallback","_step","_draw","images","xy","bg","_getNextAnimationFrame","currentFrame","branching","exitBranch","rnd","branches","branch","weight","frameIndex","_playSound","s","sound","audio","_atLastFrame","frames","newFrameIndex","min","frameChanged","useExitBranching","_loop","targetEl","_targetEl","_setup","WORD_SPEAK_TIME","CLOSE_BALLOON_DELAY","_content","find","sides","_position","_isOut","_BALLOON_MARGIN","side","removeClass","addClass","_complete","_sayWords","_hiding","_finishHideBalloon","_active","_hold","words","split","_addWord","slice","join","BASE_PATH","load","successCb","failCb","mapDfd","_loadMap","agentDfd","_loadAgent","soundsDfd","_loadSounds","when","fail","_maps","dfd","src","img","Image","onload","onerror","reject","setAttribute","promise","createElement","canPlayMp3","canPlayType","canPlayOgg","_loadScript","_getAgentDfd","script","head","appendChild","ready","soundsReady","onEmptyCallback","_onEmptyCallback","_progressQueue","f","shift","completeFunction","next","call"],"mappings":"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","file":"clippy.js","sourcesContent":["// thank you Smore for this wonderful script!\r\n// https://www.smore.com/clippy-js\r\n\r\n;(function() {\r\n\r\n    window.clippy = {};\r\n    /******\r\n     *\r\n     *\r\n     * @constructor\r\n     */\r\n    clippy.Agent = function (path, data, sounds) {\r\n        this.path = path;\r\n\r\n        this._queue = new clippy.Queue($.proxy(this._onQueueEmpty, this));\r\n\r\n        this._el = $('<div class=\"clippy\"></div>').hide();\r\n\r\n        $(document.body).append(this._el);\r\n\r\n        this._animator = new clippy.Animator(this._el, path, data, sounds);\r\n\r\n        this._balloon = new clippy.Balloon(this._el);\r\n\r\n        this._setupEvents();\r\n    };\r\n\r\n    clippy.Agent.prototype = {\r\n\r\n        /**************************** API ************************************/\r\n\r\n        /***\r\n         *\r\n         * @param {Number} x\r\n         * @param {Number} y\r\n         */\r\n        gestureAt:function (x, y) {\r\n            var d = this._getDirection(x, y);\r\n            var gAnim = 'Gesture' + d;\r\n            var lookAnim = 'Look' + d;\r\n\r\n            var animation = this.hasAnimation(gAnim) ? gAnim : lookAnim;\r\n            return this.play(animation);\r\n        },\r\n\r\n        /***\r\n         *\r\n         * @param {Boolean=} fast\r\n         *\r\n         */\r\n        hide:function (fast, callback) {\r\n            this._hidden = true;\r\n            var el = this._el;\r\n            this.stop();\r\n            if (fast) {\r\n                this._el.hide();\r\n                this.stop();\r\n                this.pause();\r\n                if (callback) callback();\r\n                return;\r\n            }\r\n\r\n            return this._playInternal('Hide', function () {\r\n                el.hide();\r\n                this.pause();\r\n                if (callback) callback();\r\n            })\r\n        },\r\n\r\n\r\n        moveTo:function (x, y, duration) {\r\n            var dir = this._getDirection(x, y);\r\n            var anim = 'Move' + dir;\r\n            if (duration === undefined) duration = 1000;\r\n\r\n            this._addToQueue(function (complete) {\r\n                // the simple case\r\n                if (duration === 0) {\r\n                    this._el.css({top:y, left:x});\r\n                    this.reposition();\r\n                    complete();\r\n                    return;\r\n                }\r\n\r\n                // no animations\r\n                if (!this.hasAnimation(anim)) {\r\n                    this._el.animate({top:y, left:x}, duration, complete);\r\n                    return;\r\n                }\r\n\r\n                var callback = $.proxy(function (name, state) {\r\n                    // when exited, complete\r\n                    if (state === clippy.Animator.States.EXITED) {\r\n                        complete();\r\n                    }\r\n                    // if waiting,\r\n                    if (state === clippy.Animator.States.WAITING) {\r\n                        this._el.animate({top:y, left:x}, duration, $.proxy(function () {\r\n                            // after we're done with the movement, do the exit animation\r\n                            this._animator.exitAnimation();\r\n                        }, this));\r\n                    }\r\n\r\n                }, this);\r\n\r\n                this._playInternal(anim, callback);\r\n            }, this);\r\n        },\r\n\r\n        _playInternal:function (animation, callback) {\r\n\r\n            // if we're inside an idle animation,\r\n            if (this._isIdleAnimation() && this._idleDfd && this._idleDfd.state() === 'pending') {\r\n                this._idleDfd.done($.proxy(function () {\r\n                    this._playInternal(animation, callback);\r\n                }, this))\r\n            }\r\n\r\n            this._animator.showAnimation(animation, callback);\r\n        },\r\n\r\n        play:function (animation, timeout, cb) {\r\n            if (!this.hasAnimation(animation)) return false;\r\n\r\n            if (timeout === undefined) timeout = 5000;\r\n\r\n\r\n            this._addToQueue(function (complete) {\r\n                var completed = false;\r\n                // handle callback\r\n                var callback = function (name, state) {\r\n                    if (state === clippy.Animator.States.EXITED) {\r\n                        completed = true;\r\n                        if (cb) cb();\r\n                        complete();\r\n                    }\r\n                };\r\n\r\n                // if has timeout, register a timeout function\r\n                if (timeout) {\r\n                    window.setTimeout($.proxy(function () {\r\n                        if (completed) return;\r\n                        // exit after timeout\r\n                        this._animator.exitAnimation();\r\n                    }, this), timeout)\r\n                }\r\n\r\n                this._playInternal(animation, callback);\r\n            }, this);\r\n\r\n            return true;\r\n        },\r\n\r\n        /***\r\n         *\r\n         * @param {Boolean=} fast\r\n         */\r\n        show:function (fast) {\r\n\r\n            this._hidden = false;\r\n            if (fast) {\r\n                this._el.show();\r\n                this.resume();\r\n                this._onQueueEmpty();\r\n                return;\r\n            }\r\n\r\n            if (this._el.css('top') === 'auto' || !this._el.css('left') === 'auto') {\r\n                var left = $(window).width() * 0.8;\r\n                var top = ($(window).height() + $(document).scrollTop()) * 0.8;\r\n                this._el.css({top:top, left:left});\r\n            }\r\n\r\n            this.resume();\r\n            return this.play('Show');\r\n        },\r\n\r\n        /***\r\n         *\r\n         * @param {String} text\r\n         */\r\n        speak:function (text, hold) {\r\n            this._addToQueue(function (complete) {\r\n                this._balloon.speak(complete, text, hold);\r\n            }, this);\r\n        },\r\n\r\n\r\n        /***\r\n         * Close the current balloon\r\n         */\r\n        closeBalloon:function () {\r\n            this._balloon.hide();\r\n        },\r\n\r\n        delay:function (time) {\r\n            time = time || 250;\r\n\r\n            this._addToQueue(function (complete) {\r\n                this._onQueueEmpty();\r\n                window.setTimeout(complete, time);\r\n            });\r\n        },\r\n\r\n        /***\r\n         * Skips the current animation\r\n         */\r\n        stopCurrent:function () {\r\n            this._animator.exitAnimation();\r\n            this._balloon.close();\r\n        },\r\n\r\n\r\n        stop:function () {\r\n            // clear the queue\r\n            this._queue.clear();\r\n            this._animator.exitAnimation();\r\n            this._balloon.hide();\r\n        },\r\n\r\n        /***\r\n         *\r\n         * @param {String} name\r\n         * @returns {Boolean}\r\n         */\r\n        hasAnimation:function (name) {\r\n            return this._animator.hasAnimation(name);\r\n        },\r\n\r\n        /***\r\n         * Gets a list of animation names\r\n         *\r\n         * @return {Array.<string>}\r\n         */\r\n        animations:function () {\r\n            return this._animator.animations();\r\n        },\r\n\r\n        /***\r\n         * Play a random animation\r\n         * @return {jQuery.Deferred}\r\n         */\r\n        animate:function () {\r\n            var animations = this.animations();\r\n            var anim = animations[Math.floor(Math.random() * animations.length)];\r\n            // skip idle animations\r\n            if (anim.indexOf('Idle') === 0) {\r\n                return this.animate();\r\n            }\r\n            return this.play(anim);\r\n        },\r\n\r\n        /**************************** Utils ************************************/\r\n\r\n        /***\r\n         *\r\n         * @param {Number} x\r\n         * @param {Number} y\r\n         * @return {String}\r\n         * @private\r\n         */\r\n        _getDirection:function (x, y) {\r\n            var offset = this._el.offset();\r\n            var h = this._el.height();\r\n            var w = this._el.width();\r\n\r\n            var centerX = (offset.left + w / 2);\r\n            var centerY = (offset.top + h / 2);\r\n\r\n\r\n            var a = centerY - y;\r\n            var b = centerX - x;\r\n\r\n            var r = Math.round((180 * Math.atan2(a, b)) / Math.PI);\r\n\r\n            // Left and Right are for the character, not the screen :-/\r\n            if (-45 <= r && r < 45) return 'Right';\r\n            if (45 <= r && r < 135) return 'Up';\r\n            if (135 <= r && r <= 180 || -180 <= r && r < -135) return 'Left';\r\n            if (-135 <= r && r < -45) return 'Down';\r\n\r\n            // sanity check\r\n            return 'Top';\r\n        },\r\n\r\n        /**************************** Queue and Idle handling ************************************/\r\n\r\n        /***\r\n         * Handle empty queue.\r\n         * We need to transition the animation to an idle state\r\n         * @private\r\n         */\r\n        _onQueueEmpty:function () {\r\n            if (this._hidden || this._isIdleAnimation()) return;\r\n            var idleAnim = this._getIdleAnimation();\r\n            this._idleDfd = $.Deferred();\r\n\r\n            this._animator.showAnimation(idleAnim, $.proxy(this._onIdleComplete, this));\r\n        },\r\n\r\n        _onIdleComplete:function (name, state) {\r\n            if (state === clippy.Animator.States.EXITED) {\r\n                this._idleDfd.resolve();\r\n            }\r\n        },\r\n\r\n\r\n        /***\r\n         * Is the current animation is Idle?\r\n         * @return {Boolean}\r\n         * @private\r\n         */\r\n        _isIdleAnimation:function () {\r\n            var c = this._animator.currentAnimationName;\r\n            return c && c.indexOf('Idle') === 0;\r\n        },\r\n\r\n\r\n        /**\r\n         * Gets a random Idle animation\r\n         * @return {String}\r\n         * @private\r\n         */\r\n        _getIdleAnimation:function () {\r\n            var animations = this.animations();\r\n            var r = [];\r\n            for (var i = 0; i < animations.length; i++) {\r\n                var a = animations[i];\r\n                if (a.indexOf('Idle') === 0) {\r\n                    r.push(a);\r\n                }\r\n            }\r\n\r\n            // pick one\r\n            var idx = Math.floor(Math.random() * r.length);\r\n            return r[idx];\r\n        },\r\n\r\n        /**************************** Events ************************************/\r\n\r\n        _setupEvents:function () {\r\n            $(window).on('resize', $.proxy(this.reposition, this));\r\n\r\n            this._el.on('mousedown', $.proxy(this._onMouseDown, this));\r\n\r\n            this._el.on('dblclick', $.proxy(this._onDoubleClick, this));\r\n        },\r\n\r\n        _onDoubleClick:function () {\r\n            if (!this.play('ClickedOn')) {\r\n                this.animate();\r\n            }\r\n        },\r\n\r\n        reposition:function () {\r\n            if (!this._el.is(':visible')) return;\r\n            var o = this._el.offset();\r\n            var bH = this._el.outerHeight();\r\n            var bW = this._el.outerWidth();\r\n\r\n            var wW = $(window).width();\r\n            var wH = $(window).height();\r\n            var sT = $(window).scrollTop();\r\n            var sL = $(window).scrollLeft();\r\n\r\n            var top = o.top - sT;\r\n            var left = o.left - sL;\r\n            var m = 5;\r\n            if (top - m < 0) {\r\n                top = m;\r\n            } else if ((top + bH + m) > wH) {\r\n                top = wH - bH - m;\r\n            }\r\n\r\n            if (left - m < 0) {\r\n                left = m;\r\n            } else if (left + bW + m > wW) {\r\n                left = wW - bW - m;\r\n            }\r\n\r\n            this._el.css({left:left, top:top});\r\n            // reposition balloon\r\n            this._balloon.reposition();\r\n        },\r\n\r\n        _onMouseDown:function (e) {\r\n            e.preventDefault();\r\n            this._startDrag(e);\r\n        },\r\n\r\n\r\n        /**************************** Drag ************************************/\r\n\r\n        _startDrag:function (e) {\r\n            // pause animations\r\n            this.pause();\r\n            this._balloon.hide(true);\r\n            this._offset = this._calculateClickOffset(e);\r\n\r\n            this._moveHandle = $.proxy(this._dragMove, this);\r\n            this._upHandle = $.proxy(this._finishDrag, this);\r\n\r\n            $(window).on('mousemove', this._moveHandle);\r\n            $(window).on('mouseup', this._upHandle);\r\n\r\n            this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\r\n        },\r\n\r\n        _calculateClickOffset:function (e) {\r\n            var mouseX = e.pageX;\r\n            var mouseY = e.pageY;\r\n            var o = this._el.offset();\r\n            return {\r\n                top:mouseY - o.top,\r\n                left:mouseX - o.left\r\n            }\r\n\r\n        },\r\n\r\n        _updateLocation:function () {\r\n            this._el.css({top:this._targetY, left:this._taregtX});\r\n            this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\r\n        },\r\n\r\n        _dragMove:function (e) {\r\n            e.preventDefault();\r\n            var x = e.clientX - this._offset.left;\r\n            var y = e.clientY - this._offset.top;\r\n            this._taregtX = x;\r\n            this._targetY = y;\r\n        },\r\n\r\n        _finishDrag:function () {\r\n            window.clearTimeout(this._dragUpdateLoop);\r\n            // remove handles\r\n            $(window).off('mousemove', this._moveHandle);\r\n            $(window).off('mouseup', this._upHandle);\r\n            // resume animations\r\n            this._balloon.show();\r\n            this.reposition();\r\n            this.resume();\r\n\r\n        },\r\n\r\n        _addToQueue:function (func, scope) {\r\n            if (scope) func = $.proxy(func, scope);\r\n            this._queue.queue(func);\r\n        },\r\n\r\n        /**************************** Pause and Resume ************************************/\r\n\r\n        pause:function () {\r\n            this._animator.pause();\r\n            this._balloon.pause();\r\n\r\n        },\r\n\r\n        resume:function () {\r\n            this._animator.resume();\r\n            this._balloon.resume();\r\n        }\r\n\r\n    };\r\n\r\n    /******\r\n     *\r\n     *\r\n     * @constructor\r\n     */\r\n    clippy.Animator = function (el, path, data, sounds) {\r\n        this._el = el;\r\n        this._data = data;\r\n        this._path = path;\r\n        this._currentFrameIndex = 0;\r\n        this._currentFrame = undefined;\r\n        this._exiting = false;\r\n        this._currentAnimation = undefined;\r\n        this._endCallback = undefined;\r\n        this._started = false;\r\n        this._sounds = {};\r\n        this.currentAnimationName = undefined;\r\n        this.preloadSounds(sounds);\r\n        this._overlays = [this._el];\r\n        var curr = this._el;\r\n\r\n        this._setupElement(this._el);\r\n        for (var i = 1; i < this._data.overlayCount; i++) {\r\n            var inner = this._setupElement($('<div></div>'));\r\n\r\n            curr.append(inner);\r\n            this._overlays.push(inner);\r\n            curr = inner;\r\n        }\r\n    };\r\n\r\n    clippy.Animator.prototype = {\r\n        _setupElement:function (el) {\r\n            var frameSize = this._data.framesize;\r\n            el.css('display', \"none\");\r\n            el.css({width:frameSize[0], height:frameSize[1]});\r\n            el.css('background', \"url('\" + this._path + \"/map.png') no-repeat\");\r\n\r\n            return el;\r\n        },\r\n\r\n        animations:function () {\r\n            var r = [];\r\n            var d = this._data.animations;\r\n            for (var n in d) {\r\n                r.push(n);\r\n            }\r\n            return r;\r\n        },\r\n\r\n        preloadSounds:function (sounds) {\r\n\r\n            for (var i = 0; i < this._data.sounds.length; i++) {\r\n                var snd = this._data.sounds[i];\r\n                var uri = sounds[snd];\r\n                if (!uri) continue;\r\n                this._sounds[snd] = new Audio(uri);\r\n\r\n            }\r\n        },\r\n        hasAnimation:function (name) {\r\n            return !!this._data.animations[name];\r\n        },\r\n\r\n        exitAnimation:function () {\r\n            this._exiting = true;\r\n        },\r\n\r\n\r\n        showAnimation:function (animationName, stateChangeCallback) {\r\n            this._exiting = false;\r\n\r\n            if (!this.hasAnimation(animationName)) {\r\n                return false;\r\n            }\r\n\r\n            this._currentAnimation = this._data.animations[animationName];\r\n            this.currentAnimationName = animationName;\r\n\r\n\r\n            if (!this._started) {\r\n                this._step();\r\n                this._started = true;\r\n            }\r\n\r\n            this._currentFrameIndex = 0;\r\n            this._currentFrame = undefined;\r\n            this._endCallback = stateChangeCallback;\r\n\r\n            return true;\r\n        },\r\n\r\n\r\n        _draw:function () {\r\n            var images = [];\r\n            if (this._currentFrame) images = this._currentFrame.images || [];\r\n\r\n            for (var i = 0; i < this._overlays.length; i++) {\r\n                if (i < images.length) {\r\n                    var xy = images[i];\r\n                    var bg = -xy[0] + 'px ' + -xy[1] + 'px';\r\n                    this._overlays[i].css({'background-position':bg, 'display':'block'});\r\n                }\r\n                else {\r\n                    this._overlays[i].css('display', 'none');\r\n                }\r\n\r\n            }\r\n        },\r\n\r\n        _getNextAnimationFrame:function () {\r\n            if (!this._currentAnimation) return undefined;\r\n            // No current frame. start animation.\r\n            if (!this._currentFrame) return 0;\r\n            var currentFrame = this._currentFrame;\r\n            var branching = this._currentFrame.branching;\r\n\r\n\r\n            if (this._exiting && currentFrame.exitBranch !== undefined) {\r\n                return currentFrame.exitBranch;\r\n            }\r\n            else if (branching) {\r\n                var rnd = Math.random() * 100;\r\n                for (var i = 0; i < branching.branches.length; i++) {\r\n                    var branch = branching.branches[i];\r\n                    if (rnd <= branch.weight) {\r\n                        return branch.frameIndex;\r\n                    }\r\n\r\n                    rnd -= branch.weight;\r\n                }\r\n            }\r\n\r\n            return this._currentFrameIndex + 1;\r\n        },\r\n\r\n        _playSound:function () {\r\n            var s = this._currentFrame.sound;\r\n            if (!s) return;\r\n            var audio = this._sounds[s];\r\n            if (audio) audio.play();\r\n        },\r\n\r\n        _atLastFrame:function () {\r\n            return this._currentFrameIndex >= this._currentAnimation.frames.length - 1;\r\n        },\r\n\r\n        _step:function () {\r\n            if (!this._currentAnimation) return;\r\n            var newFrameIndex = Math.min(this._getNextAnimationFrame(), this._currentAnimation.frames.length - 1);\r\n            var frameChanged = !this._currentFrame || this._currentFrameIndex !== newFrameIndex;\r\n            this._currentFrameIndex = newFrameIndex;\r\n\r\n            // always switch frame data, unless we're at the last frame of an animation with a useExitBranching flag.\r\n            if (!(this._atLastFrame() && this._currentAnimation.useExitBranching)) {\r\n                this._currentFrame = this._currentAnimation.frames[this._currentFrameIndex];\r\n            }\r\n\r\n            this._draw();\r\n            this._playSound();\r\n\r\n            this._loop = window.setTimeout($.proxy(this._step, this), this._currentFrame.duration);\r\n\r\n\r\n            // fire events if the frames changed and we reached an end\r\n            if (this._endCallback && frameChanged && this._atLastFrame()) {\r\n                if (this._currentAnimation.useExitBranching && !this._exiting) {\r\n                    this._endCallback(this.currentAnimationName, clippy.Animator.States.WAITING);\r\n                }\r\n                else {\r\n                    this._endCallback(this.currentAnimationName, clippy.Animator.States.EXITED);\r\n                }\r\n            }\r\n        },\r\n\r\n        /***\r\n         * Pause animation execution\r\n         */\r\n        pause:function () {\r\n            window.clearTimeout(this._loop);\r\n        },\r\n\r\n        /***\r\n         * Resume animation\r\n         */\r\n        resume:function () {\r\n            this._step();\r\n        }\r\n    };\r\n\r\n    clippy.Animator.States = { WAITING:1, EXITED:0 };\r\n\r\n    /******\r\n     *\r\n     *\r\n     * @constructor\r\n     */\r\n    clippy.Balloon = function (targetEl) {\r\n        this._targetEl = targetEl;\r\n\r\n        this._hidden = true;\r\n        this._setup();\r\n    };\r\n\r\n    clippy.Balloon.prototype = {\r\n\r\n        WORD_SPEAK_TIME:320,\r\n        CLOSE_BALLOON_DELAY:2000,\r\n\r\n        _setup:function () {\r\n\r\n            this._balloon = $('<div class=\"clippy-balloon\"><div class=\"clippy-tip\"></div><div class=\"clippy-content\"></div></div> ').hide();\r\n            this._content = this._balloon.find('.clippy-content');\r\n\r\n            $(document.body).append(this._balloon);\r\n        },\r\n\r\n        reposition:function () {\r\n            var sides = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\r\n\r\n            for (var i = 0; i < sides.length; i++) {\r\n                var s = sides[i];\r\n                this._position(s);\r\n                if (!this._isOut()) break;\r\n            }\r\n        },\r\n\r\n        _BALLOON_MARGIN:15,\r\n\r\n        /***\r\n         *\r\n         * @param side\r\n         * @private\r\n         */\r\n        _position:function (side) {\r\n            var o = this._targetEl.offset();\r\n            var h = this._targetEl.height();\r\n            var w = this._targetEl.width();\r\n\r\n            var bH = this._balloon.outerHeight();\r\n            var bW = this._balloon.outerWidth();\r\n\r\n            this._balloon.removeClass('clippy-top-left');\r\n            this._balloon.removeClass('clippy-top-right');\r\n            this._balloon.removeClass('clippy-bottom-right');\r\n            this._balloon.removeClass('clippy-bottom-left');\r\n\r\n            var left, top;\r\n            switch (side) {\r\n                case 'top-left':\r\n                    // right side of the balloon next to the right side of the agent\r\n                    left = o.left + w - bW;\r\n                    top = o.top - bH - this._BALLOON_MARGIN;\r\n                    break;\r\n                case 'top-right':\r\n                    // left side of the balloon next to the left side of the agent\r\n                    left = o.left;\r\n                    top = o.top - bH - this._BALLOON_MARGIN;\r\n                    break;\r\n                case 'bottom-right':\r\n                    // right side of the balloon next to the right side of the agent\r\n                    left = o.left;\r\n                    top = o.top + h + this._BALLOON_MARGIN;\r\n                    break;\r\n                case 'bottom-left':\r\n                    // left side of the balloon next to the left side of the agent\r\n                    left = o.left + w - bW;\r\n                    top = o.top + h + this._BALLOON_MARGIN;\r\n                    break;\r\n            }\r\n\r\n            this._balloon.css({top:top, left:left});\r\n            this._balloon.addClass('clippy-' + side);\r\n        },\r\n\r\n        _isOut:function () {\r\n            var o = this._balloon.offset();\r\n            var bH = this._balloon.outerHeight();\r\n            var bW = this._balloon.outerWidth();\r\n\r\n            var wW = $(window).width();\r\n            var wH = $(window).height();\r\n            var sT = $(document).scrollTop();\r\n            var sL = $(document).scrollLeft();\r\n\r\n            var top = o.top - sT;\r\n            var left = o.left - sL;\r\n            var m = 5;\r\n            if (top - m < 0 || left - m < 0) return true;\r\n            if ((top + bH + m) > wH || (left + bW + m) > wW) return true;\r\n\r\n            return false;\r\n        },\r\n\r\n        speak:function (complete, text, hold) {\r\n            this._hidden = false;\r\n            this.show();\r\n            var c = this._content;\r\n            // set height to auto\r\n            c.height('auto');\r\n            c.width('auto');\r\n            // add the text\r\n            c.text(text);\r\n            // set height\r\n            c.height(c.height());\r\n            c.width(c.width());\r\n            c.text('');\r\n            this.reposition();\r\n\r\n            this._complete = complete;\r\n            this._sayWords(text, hold, complete);\r\n        },\r\n\r\n        show:function () {\r\n            if (this._hidden) return;\r\n            this._balloon.show();\r\n        },\r\n\r\n        hide:function (fast) {\r\n            if (fast) {\r\n                this._balloon.hide();\r\n                return;\r\n            }\r\n\r\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\r\n        },\r\n\r\n        _finishHideBalloon:function () {\r\n            if (this._active) return;\r\n            this._balloon.hide();\r\n            this._hidden = true;\r\n            this._hiding = null;\r\n        },\r\n\r\n        _sayWords:function (text, hold, complete) {\r\n            this._active = true;\r\n            this._hold = hold;\r\n            var words = text.split(/[^\\S-]/);\r\n            var time = this.WORD_SPEAK_TIME;\r\n            var el = this._content;\r\n            var idx = 1;\r\n\r\n\r\n            this._addWord = $.proxy(function () {\r\n                if (!this._active) return;\r\n                if (idx > words.length) {\r\n                    this._active = false;\r\n                    if (!this._hold) {\r\n                        complete();\r\n                        this.hide();\r\n                    }\r\n                } else {\r\n                    el.text(words.slice(0, idx).join(' '));\r\n                    idx++;\r\n                    this._loop = window.setTimeout($.proxy(this._addWord, this), time);\r\n                }\r\n            }, this);\r\n\r\n            this._addWord();\r\n\r\n        },\r\n\r\n        close:function () {\r\n            if (this._active) {\r\n                this._hold = false;\r\n            } else if (this._hold) {\r\n                this._complete();\r\n            }\r\n        },\r\n\r\n        pause:function () {\r\n            window.clearTimeout(this._loop);\r\n            if (this._hiding) {\r\n                window.clearTimeout(this._hiding);\r\n                this._hiding = null;\r\n            }\r\n        },\r\n\r\n        resume:function () {\r\n            if (this._addWord)  this._addWord();\r\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\r\n        }\r\n\r\n\r\n    };\r\n\r\n    clippy.BASE_PATH = '//s3.amazonaws.com/clippy.js/Agents/';\r\n\r\n    clippy.load = function (name, successCb, failCb) {\r\n        var path = clippy.BASE_PATH + name;\r\n\r\n        var mapDfd = clippy.load._loadMap(path);\r\n        var agentDfd = clippy.load._loadAgent(name, path);\r\n        var soundsDfd = clippy.load._loadSounds(name, path);\r\n\r\n        var data;\r\n        agentDfd.done(function (d) {\r\n            data = d;\r\n        });\r\n\r\n        var sounds;\r\n\r\n        soundsDfd.done(function (d) {\r\n            sounds = d;\r\n        });\r\n\r\n        // wrapper to the success callback\r\n        var cb = function () {\r\n            var a = new clippy.Agent(path, data,sounds);\r\n            successCb(a);\r\n        };\r\n\r\n        $.when(mapDfd, agentDfd, soundsDfd).done(cb).fail(failCb);\r\n    };\r\n\r\n    clippy.load._maps = {};\r\n    clippy.load._loadMap = function (path) {\r\n        var dfd = clippy.load._maps[path];\r\n        if (dfd) return dfd;\r\n\r\n        // set dfd if not defined\r\n        dfd = clippy.load._maps[path] = $.Deferred();\r\n\r\n        var src = path + '/map.png';\r\n        var img = new Image();\r\n\r\n        img.onload = dfd.resolve;\r\n        img.onerror = dfd.reject;\r\n\r\n        // start loading the map;\r\n        img.setAttribute('src', src);\r\n\r\n        return dfd.promise();\r\n    };\r\n\r\n    clippy.load._sounds = {};\r\n\r\n    clippy.load._loadSounds = function (name, path) {\r\n        var dfd = clippy.load._sounds[name];\r\n        if (dfd) return dfd;\r\n\r\n        // set dfd if not defined\r\n        dfd = clippy.load._sounds[name] = $.Deferred();\r\n\r\n        var audio = document.createElement('audio');\r\n        var canPlayMp3 = !!audio.canPlayType && \"\" != audio.canPlayType('audio/mpeg');\r\n        var canPlayOgg = !!audio.canPlayType && \"\" != audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\r\n\r\n        if (!canPlayMp3 && !canPlayOgg) {\r\n            dfd.resolve({});\r\n        } else {\r\n            var src = path + (canPlayMp3 ? '/sounds-mp3.js' : '/sounds-ogg.js');\r\n            // load\r\n            clippy.load._loadScript(src);\r\n        }\r\n\r\n        return dfd.promise()\r\n    };\r\n\r\n\r\n    clippy.load._data = {};\r\n    clippy.load._loadAgent = function (name, path) {\r\n        var dfd = clippy.load._data[name];\r\n        if (dfd) return dfd;\r\n\r\n        dfd = clippy.load._getAgentDfd(name);\r\n\r\n        var src = path + '/agent.js';\r\n\r\n        clippy.load._loadScript(src);\r\n\r\n        return dfd.promise();\r\n    };\r\n\r\n    clippy.load._loadScript = function (src) {\r\n        var script = document.createElement('script');\r\n        script.setAttribute('src', src);\r\n        script.setAttribute('async', 'async');\r\n        script.setAttribute('type', 'text/javascript');\r\n\r\n        document.head.appendChild(script);\r\n    };\r\n\r\n    clippy.load._getAgentDfd = function (name) {\r\n        var dfd = clippy.load._data[name];\r\n        if (!dfd) {\r\n            dfd = clippy.load._data[name] = $.Deferred();\r\n        }\r\n        return dfd;\r\n    };\r\n\r\n    clippy.ready = function (name, data) {\r\n        var dfd = clippy.load._getAgentDfd(name);\r\n        dfd.resolve(data);\r\n    };\r\n\r\n    clippy.soundsReady = function (name, data) {\r\n        var dfd = clippy.load._sounds[name];\r\n        if (!dfd) {\r\n            dfd = clippy.load._sounds[name] = $.Deferred();\r\n        }\r\n\r\n        dfd.resolve(data);\r\n    };\r\n\r\n    /******\r\n     * Tiny Queue\r\n     *\r\n     * @constructor\r\n     */\r\n    clippy.Queue = function (onEmptyCallback) {\r\n        this._queue = [];\r\n        this._onEmptyCallback = onEmptyCallback;\r\n    };\r\n\r\n    clippy.Queue.prototype = {\r\n        /***\r\n         *\r\n         * @param {function(Function)} func\r\n         * @returns {jQuery.Deferred}\r\n         */\r\n        queue:function (func) {\r\n            this._queue.push(func);\r\n\r\n            if (this._queue.length === 1 && !this._active) {\r\n                this._progressQueue();\r\n            }\r\n        },\r\n\r\n        _progressQueue:function () {\r\n\r\n            // stop if nothing left in queue\r\n            if (!this._queue.length) {\r\n                this._onEmptyCallback();\r\n                return;\r\n            }\r\n\r\n            var f = this._queue.shift();\r\n            this._active = true;\r\n\r\n            // execute function\r\n            var completeFunction = $.proxy(this.next, this);\r\n            f(completeFunction);\r\n        },\r\n\r\n        clear:function () {\r\n            this._queue = [];\r\n        },\r\n\r\n        next:function () {\r\n            this._active = false;\r\n            this._progressQueue();\r\n        }\r\n    };\r\n\r\n}.call(this));"]}