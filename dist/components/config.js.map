{"version":3,"sources":["../../src/components/config.js"],"names":["_","appName","AnalyticEngineAppConfigCtrl","$scope","$injector","$q","backendSrv","alertSrv","appEditCtrl","setPreUpdateHook","preUpdate","bind","setPostUpdateHook","postUpdate","model","appModel","enabled","resolve","_isValidateAnalyticEngineURL","jsonData","analyticEngineURL","errorMsg","reject","appConfig","post","then","console","log","importDashboards","url","message","get","results","isString","templateUrl"],"mappings":";;;;;;;;;;;;;;;AAAOA,O;;;;;;;;;;;;;;;;;;;;;AAEHC,a,GAAU,iB;;6CAEDC,2B;AACX,6CAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,EAA/B,EAAmCC,UAAnC,EAA+CC,QAA/C,EAAyD;AAAA;;AACvD,eAAKF,EAAL,GAAUA,EAAV;AACA,eAAKC,UAAL,GAAkBA,UAAlB;AACA,eAAKC,QAAL,GAAgBA,QAAhB;AACA,eAAKC,WAAL,CAAiBC,gBAAjB,CAAkC,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAlC;AACA,eAAKH,WAAL,CAAiBI,iBAAjB,CAAmC,KAAKC,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAnC;;AAEA;AACA;AACD;;;;sCAEW;AACV,gBAAIG,QAAQ,KAAKC,QAAjB;AACA,gBAAI,CAACD,MAAME,OAAX,EAAoB;AAClB,qBAAO,KAAKX,EAAL,CAAQY,OAAR,EAAP;AACD;;AAED,gBAAI,CAAC,KAAKC,4BAAL,CAAkCJ,MAAMK,QAAN,CAAeC,iBAAjD,CAAL,EAA0E;AACxEN,oBAAME,OAAN,GAAgB,KAAhB;AACA,mBAAKK,QAAL,GAAmBpB,OAAnB;AACA,qBAAO,KAAKI,EAAL,CAAQiB,MAAR,CAAe,KAAKD,QAApB,CAAP;AACD;;AAED,gBAAIE,YAAY,EAACJ,UAAUL,MAAMK,QAAjB,EAAhB;AACA,mBAAO,KAAKb,UAAL,CAAgBkB,IAAhB,CAAqB,0CAArB,EAAiED,SAAjE,EAA4EE,IAA5E,CAAiF,gBAAQ;AAC9FC,sBAAQC,GAAR,CAAY,iCAAZ;AACD,aAFM,CAAP;AAGD;;;uCAEY;AACX,gBAAI,CAAC,KAAKZ,QAAL,CAAcC,OAAnB,EAA4B;AAC1B,qBAAO,KAAKX,EAAL,CAAQY,OAAR,EAAP;AACD;;AAED,mBAAO,KAAKT,WAAL,CAAiBoB,gBAAjB,GAAoCH,IAApC,CAAyC,YAAM;AACpD,qBAAO;AACLI,qBAAK,mCADA;AAELC,yBAAS;AAFJ,eAAP;AAID,aALM,CAAP;AAMD;;;sCAEW;AACV,mBAAO,KAAKxB,UAAL,CAAgByB,GAAhB,CAAoB,0CAApB,EAAgEN,IAAhE,CAAqE,mBAAW;AACrFC,sBAAQC,GAAR,CAAYK,OAAZ;AACD,aAFM,CAAP;AAGD;;;uDAE4BH,G,EAAK;AAChC,mBAAO7B,EAAEiC,QAAF,CAAWJ,GAAX,CAAP;AACD;;;;;;;;AAEH3B,kCAA4BgC,WAA5B,GAA0C,wBAA1C","file":"config.js","sourcesContent":["import _ from 'lodash'\n\nlet appName = \"Analytic Engine\";\n\nexport class AnalyticEngineAppConfigCtrl {\n  constructor($scope, $injector, $q, backendSrv, alertSrv) {\n    this.$q = $q;\n    this.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.appEditCtrl.setPreUpdateHook(this.preUpdate.bind(this));\n    this.appEditCtrl.setPostUpdateHook(this.postUpdate.bind(this));\n\n    // TODO: We will worry about security later. As for the moment,\n    //       anyone can do query to our analyic-engine.\n  }\n\n  preUpdate() {\n    let model = this.appModel;\n    if (!model.enabled) {\n      return this.$q.resolve();\n    }\n\n    if (!this._isValidateAnalyticEngineURL(model.jsonData.analyticEngineURL)) {\n      model.enabled = false;\n      this.errorMsg = `${appName} Server URL is not valid.`;\n      return this.$q.reject(this.errorMsg);\n    }\n\n    let appConfig = {jsonData: model.jsonData};\n    return this.backendSrv.post('api/plugins/analytic-engine-app/settings', appConfig).then(resp => {\n      console.log('Analytic Engine config updated.');\n    });\n  }\n\n  postUpdate() {\n    if (!this.appModel.enabled) {\n      return this.$q.resolve();\n    }\n\n    return this.appEditCtrl.importDashboards().then(() => {\n      return {\n        url: \"dashboard/db/analytic-engine-home\",\n        message: \"worldPing app installed!\"\n      };\n    });\n  }\n\n  getConfig() {\n    return this.backendSrv.get('api/plugins/analytic-engine-app/settings').then(results => {\n      console.log(results);\n    });\n  }\n\n  _isValidateAnalyticEngineURL(url) {\n    return _.isString(url);\n  }\n}\nAnalyticEngineAppConfigCtrl.templateUrl = 'components/config.html';\n\n\n"]}